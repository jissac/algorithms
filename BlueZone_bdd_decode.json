{"paragraphs":[{"text":"import org.apache.spark.sql.SparkSession\r\nimport com.ford.cbz.App._\r\nimport com.ford.cbz.Functions.{getSecond, makeGPS, makeTimestamp}\r\nimport javax.xml.bind.DatatypeConverter\r\nimport org.apache.spark.sql.expressions.Window\r\nimport java.security.MessageDigest\r\nimport java.sql.Timestamp\r\nimport scala.collection.JavaConversions._\r\nimport org.apache.spark.sql.functions._","user":"jissac3","dateUpdated":"2019-03-21T12:50:50-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.SparkSession\nimport com.ford.cbz.App._\nimport com.ford.cbz.Functions.{getSecond, makeGPS, makeTimestamp}\nimport javax.xml.bind.DatatypeConverter\nimport org.apache.spark.sql.expressions.Window\nimport java.security.MessageDigest\nimport java.sql.Timestamp\nimport scala.collection.JavaConversions._\nimport org.apache.spark.sql.functions._\n"}]},"apps":[],"jobName":"paragraph_1550898587589_-1040495560","id":"20190223-000947_1003075864","dateCreated":"2019-02-23T00:09:47-0500","dateStarted":"2019-03-21T12:50:50-0400","dateFinished":"2019-03-21T12:51:47-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:254"},{"text":"%md\n### Load BDD Data","user":"jissac3","dateUpdated":"2019-03-13T16:16:21-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Load BDD Data</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1552500428647_-859662862","id":"20190313-140708_1787495749","dateCreated":"2019-03-13T14:07:08-0400","dateStarted":"2019-03-13T16:16:21-0400","dateFinished":"2019-03-13T16:16:21-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:255"},{"text":"// I created a separate Hive table (Spark was having trouble reading the SCA-V table)\n// set set hive.execution.engine=mr;\n// drop table jissac3.bdd_did_data;\n// create table jissac3.bdd_did_data as SELECT * from cvdp.ncvdct9_bdd_blue_zone_sec_hte;\n\nval df = spark.sql(\"select * from jissac3.bdd_did_data\")\n//z.show(df)\ndf.printSchema\n","user":"jissac3","dateUpdated":"2019-03-21T12:56:44-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"cvdct9_sha_k":"string","cvdct9_vin_d_3":"string","cvdct9_mac_d_3":"string","cvdct9_data_x_3":"string","cvdct9_event_s":"string","cvdct9_process_stat_c":"string","cvdct9_process_stat_dtl_x":"string","cvdct9_process_stat_utc_s":"string","cvdct9_created_on_s":"string","cvdct9_created_by_c":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{},"keys":[{"name":"cvdct9_sha_k","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"cvdct9_vin_d_3","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- cvdct9_sha_k: string (nullable = true)\n |-- cvdct9_vin_d_3: string (nullable = true)\n |-- cvdct9_mac_d_3: string (nullable = true)\n |-- cvdct9_data_x_3: string (nullable = true)\n |-- cvdct9_event_s: timestamp (nullable = true)\n |-- cvdct9_process_stat_c: string (nullable = true)\n |-- cvdct9_process_stat_dtl_x: string (nullable = true)\n |-- cvdct9_process_stat_utc_s: timestamp (nullable = true)\n |-- cvdct9_created_on_s: timestamp (nullable = true)\n |-- cvdct9_created_by_c: string (nullable = true)\n\ndf: org.apache.spark.sql.DataFrame = [cvdct9_sha_k: string, cvdct9_vin_d_3: string ... 8 more fields]\n"}]},"apps":[],"jobName":"paragraph_1551298547569_-994408707","id":"20190227-151547_655336952","dateCreated":"2019-02-27T15:15:47-0500","dateStarted":"2019-03-21T12:56:44-0400","dateFinished":"2019-03-21T12:56:45-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:256"},{"text":"%md\n### DID Decode","user":"jissac3","dateUpdated":"2019-03-13T16:16:10-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>DID Decode</h3>\n</div>"}]},"apps":[],"jobName":"paragraph_1551296776280_672244054","id":"20190227-144616_340682150","dateCreated":"2019-02-27T14:46:16-0500","dateStarted":"2019-03-13T16:16:10-0400","dateFinished":"2019-03-13T16:16:10-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:259"},{"text":"val parsedDF = df.filter(col(\"cvdct9_data_x_3\").isNotNull).flatMap(row => {\n    val payload = row.getAs[String](\"cvdct9_data_x_3\")\n    .substring(1)\n    .replaceAll(\"..(?!$)\", \"$0 \")\n    .split(\" \")\n    .map(bytes => if (bytes.length == 1) \"0\" + bytes else bytes)\n    .map(Integer.parseInt(_, 16).toByte)\n    .toArray\n    val vehId = row.getAs[String](\"cvdct9_vin_d_3\")\n    val date = row.getAs[java.sql.Timestamp](\"cvdct9_event_s\")\n    val dids = decode30Sec(payload.slice(3, payload.length)).map(_.asInstanceOf[Array[com.ford.cbz.cBZRawDataParameter]]).toArray\n    var i = 0 \n    var lastSecond = -3\n    payload.foreach(payload => println(payload))\n    \n    dids.map(did => {\n        i += 1\n        val lat = makeGPS(did(14).engineeringValue.toInt, did(13).engineeringValue.toInt, did(15).engineeringValue.toDouble)\n        val long = makeGPS(did(17).engineeringValue.toInt, did(16).engineeringValue.toInt, did(18).engineeringValue.toDouble)\n        \n        var second = -99\n        val secondResult = getSecond(did(21).rawValue.toInt, i, dids)\n        \n        if (secondResult >= 0) {\n            second = secondResult\n        } else if (secondResult == -1) {\n            second = lastSecond + 1\n        } else {\n            second = -99\n        }\n        \n        if (second >= 60) second = second - 60\n        lastSecond = second\n        \n        val timestamp = makeTimestamp(date.getYear + 1900, date.getMonth + 1, date.getDate, did(20).rawValue.toInt, did(21).rawValue.toInt, second)\n        println(s\"$timestamp: $date\")\n        \n        (i, lat, long, did(0).rawValue.toInt, did(1).rawValue.toInt, did(2).rawValue.toInt, did(3).rawValue.toInt, did(4).rawValue.toInt, did(5).rawValue.toInt, did(6).engineeringValue.toDouble, did(7).engineeringValue.toDouble, did(8).engineeringValue.toDouble, did(9).engineeringValue.toDouble, did(10).engineeringValue.toDouble, did(19).rawValue.toInt, timestamp, did(22).rawValue.toInt, did(23).rawValue.toDouble, did(24).rawValue.toInt, vehId)\n        }).filter(_._1 < 30)\n    \n}).toDF(\"seq_num\", \"latitude\", \"longitude\", \"VIS_LANE_AMBIG_LEFT\", \"VIS_LANE_AMBIG_RIGHT\", \"VIS_LANE_LEFT_IND_TYPE\",\n        \"VIS_LANE_RIGHT_IND_TYPE\", \"VIS_LANE_LEFT_ID_LKACONF\", \"VIS_LANE_RIGHT_IND_LKACONF\", \"SP_lane_width\", \"VIS_LANE_LEFT_IND_A2\",\n        \"VIS_LANE_RIGHT_IND_A2\", \"VIS_LANE_LEFT_IND_RANGE\", \"VIS_LANE_RIGHT_IND_RANGE\", \"GPS_B_Falt\", \"timestamp\",\n        \"WiprFront_D_Stat\", \"GPS_Heading\", \"VehoverGnd_V_Est\", \"vehicle_id\").withColumn(\"file_name\", input_file_name())","user":"jissac3","dateUpdated":"2019-03-21T12:56:51-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"vin":"string","mac":"string","bz_data":"string","ts":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there were three deprecation warnings; re-run with -deprecation for details\nparsedDF: org.apache.spark.sql.DataFrame = [seq_num: int, latitude: double ... 19 more fields]\n"}]},"apps":[],"jobName":"paragraph_1551117524363_373616746","id":"20190225-125844_877088401","dateCreated":"2019-02-25T12:58:44-0500","dateStarted":"2019-03-21T12:56:51-0400","dateFinished":"2019-03-21T12:57:02-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:260"},{"text":"parsedDF.select(\"latitude\",\"longitude\",\"WiprFront_D_Stat\", \"GPS_Heading\", \"VehoverGnd_V_Est\", \"vehicle_id\").show()","user":"jissac3","dateUpdated":"2019-03-21T12:57:10-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------+------------------+----------------+-----------+----------------+-----------------+\n|          latitude|         longitude|WiprFront_D_Stat|GPS_Heading|VehoverGnd_V_Est|       vehicle_id|\n+------------------+------------------+----------------+-----------+----------------+-----------------+\n|42.384753333333336|        -83.436375|               1|        0.0|           18866|2FMPK3J93KBB00775|\n| 42.38498666666667|-83.43634833333333|               1|        0.0|           18612|2FMPK3J93KBB00775|\n|42.385216666666665|        -83.436315|               1|        0.0|           18406|2FMPK3J93KBB00775|\n|42.385448333333336|-83.43626666666667|               1|        0.0|           18242|2FMPK3J93KBB00775|\n| 42.38567333333334|-83.43621333333333|               9|        0.0|           18070|2FMPK3J93KBB00775|\n|         42.385895|-83.43616166666666|               1|        0.0|           17844|2FMPK3J93KBB00775|\n|          42.38612|-83.43610666666666|               1|        0.0|           17620|2FMPK3J93KBB00775|\n|         42.386335|-83.43604833333333|               1|        0.0|           17396|2FMPK3J93KBB00775|\n| 42.38655333333333|-83.43598833333333|               9|        0.0|           17190|2FMPK3J93KBB00775|\n|42.378973333333334|          -83.4365|               1|        0.0|           23722|2FMPK3J93KBB00775|\n| 42.37927333333333|        -83.436495|               1|        0.0|           23570|2FMPK3J93KBB00775|\n| 42.37957333333333|        -83.436485|               1|        0.0|           23218|2FMPK3J93KBB00775|\n|42.379871666666666|-83.43647666666666|               1|        0.0|           22830|2FMPK3J93KBB00775|\n|42.380163333333336|-83.43647166666666|               1|        0.0|           22704|2FMPK3J93KBB00775|\n| 42.38045666666667|-83.43646833333334|               9|        0.0|           22676|2FMPK3J93KBB00775|\n| 42.38075166666667|-83.43646833333334|               9|        0.0|           22664|2FMPK3J93KBB00775|\n|          42.38104|         -83.43647|               1|        0.0|           22628|2FMPK3J93KBB00775|\n|42.381328333333336|-83.43647166666666|               1|        0.0|           22432|2FMPK3J93KBB00775|\n|          42.38162|-83.43647666666666|               1|        0.0|           22050|2FMPK3J93KBB00775|\n|42.381901666666664|-83.43648666666667|               1|        0.0|           21686|2FMPK3J93KBB00775|\n+------------------+------------------+----------------+-----------+----------------+-----------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1552507059558_-2055526284","id":"20190313-155739_1484637921","dateCreated":"2019-03-13T15:57:39-0400","dateStarted":"2019-03-21T12:57:10-0400","dateFinished":"2019-03-21T12:57:29-0400","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:261","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://hpca04r04n14.hpc.ford.com:42523/jobs"],"interpreterSettingId":"spark"}}},{"user":"jissac3","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1553187119410_1994058345","id":"20190321-125159_2112899056","dateCreated":"2019-03-21T12:51:59-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1207","text":"%md \n### Convert Dataframe to Hive table","dateUpdated":"2019-03-21T12:52:31-0400","dateFinished":"2019-03-21T12:52:31-0400","dateStarted":"2019-03-21T12:52:31-0400","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Convert Dataframe to Hive table</h3>\n</div>"}]}},{"text":"parsedDF.createOrReplaceTempView(\"mytempTable\") \nspark.sql(\"set hive.execution.engine=mr\")\n//spark.sql(\"drop table jissac3.bdd_did_decoded_data\") \nspark.sql(\"create table jissac3.bdd_did_decoded_data as SELECT * from mytempTable\");\n","user":"jissac3","dateUpdated":"2019-03-21T13:06:28-0400","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1553187487776_-1559130722","id":"20190321-125807_116553746","dateCreated":"2019-03-21T12:58:07-0400","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1575","dateFinished":"2019-03-21T13:07:41-0400","dateStarted":"2019-03-21T13:06:28-0400","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res8: org.apache.spark.sql.DataFrame = []\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://hpca04r04n14.hpc.ford.com:42523/jobs"],"interpreterSettingId":"spark"}}}],"name":"BlueZone/bdd_decode","id":"2E3PN8JA9","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}